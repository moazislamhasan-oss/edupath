<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPath - University Finder Egypt</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
        
        :root {
            --primary-color: #ffffff;
            --secondary-color: #007bff;
            --accent-color: #ffc107;
            --text-color: #333333;
            --light-bg: #f8f9fa;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --success-color: #28a745;
            --error-color: #dc3545;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            position: relative;
        }

        body.modal-open {
            overflow: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
            width: 100%;
            box-sizing: border-box;
        }

        header {
            background-color: var(--primary-color);
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 1rem 0;
            box-shadow: 0 2px 5px var(--shadow-color);
            position: sticky;
            top: 0;
            z-index: 500;
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        header h1 {
            margin: 0;
            font-size: 2rem;
            font-weight: 700;
            color: var(--secondary-color);
        }
        
        header nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center;
        }

        header nav ul li {
            margin-left: 20px;
        }

        header nav ul li a {
            color: var(--text-color);
            text-decoration: none;
            font-weight: 500;
            font-size: 1rem;
            transition: color 0.3s ease;
            white-space: nowrap;
        }

        header nav ul li a:hover {
            color: var(--secondary-color);
        }

        main {
            padding: 30px 0;
            flex: 1;
        }

        #backButtonContainer {
            padding: 0 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        #backButton {
            color: var(--secondary-color);
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            transition: color 0.3s ease;
        }

        #backButton:hover {
            color: var(--text-color);
        }
        
        #backButton span {
            margin-right: 5px;
            font-size: 1.5rem;
        }

        /* Hero Section */
        #hero-section {
            background-color: var(--primary-color);
            padding: 80px 20px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px var(--shadow-color);
            animation: fadeIn 1s ease-out;
        }

        #hero-section h2 {
            font-size: 3rem;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--secondary-color);
        }

        #hero-section p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 30px auto;
            line-height: 1.5;
            color: #555;
        }

        #hero-section button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        #hero-section button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }
        
        /* New Section for Recommendations */
        #recommendation-section {
            margin-top: 30px;
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease-out;
        }
        
        #recommendation-section h2 {
            font-size: 2rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
            text-align: center;
        }
        
        #recommendation-section p {
            font-size: 1rem;
            color: #666;
            text-align: center;
            margin-bottom: 20px;
        }


        /* Search Bar */
        .search-bar {
            background-color: var(--primary-color);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px var(--shadow-color);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
            justify-content: center;
        }

        .search-bar input[type="number"],
        .search-bar input[type="text"],
        .search-bar select {
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            background-color: var(--light-bg);
            color: var(--text-color);
            border-radius: 5px;
            font-size: 1rem;
            flex: 1;
            min-width: 200px;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .search-bar input[type="number"]:focus,
        .search-bar input[type="text"]:focus,
        .search-bar select:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
        }
        
        .search-bar select option {
            background-color: var(--primary-color);
            color: var(--text-color);
        }

        .search-bar button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            flex-shrink: 0;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .search-bar button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        /* University Grid & Cards */
        .university-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .university-card {
            background-color: var(--primary-color);
            border-radius: 8px;
            box-shadow: 0 2px 8px var(--shadow-color);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
        }

        .university-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--shadow-color);
        }

        .university-card-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-bottom: 1px solid var(--border-color);
        }

        .university-card-header {
            background-color: var(--light-bg);
            color: var(--secondary-color);
            padding: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            text-align: center;
        }

        .university-card-body {
            padding: 20px;
            flex-grow: 1;
        }

        .university-card-body p {
            margin: 8px 0;
            font-size: 0.9rem;
        }
        
        .university-card-body p.min-score {
            font-weight: bold;
            color: var(--success-color);
        }

        .university-card-body .faculty-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }

        .university-card-body .faculty-list li {
            background-color: var(--light-bg);
            color: var(--text-color);
            padding: 5px 10px;
            border-radius: 5px;
            margin-bottom: 5px;
            display: inline-block;
            margin-right: 5px;
            font-size: 0.8rem;
            border: 1px solid var(--border-color);
        }
        
        .university-card-body .discount {
            color: var(--accent-color);
            font-weight: 600;
            font-size: 0.9rem;
            background-color: #fff3cd;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
            margin-bottom: 10px;
            border: 1px solid #ffeeba;
        }

        .university-card-footer {
            padding: 15px 20px;
            background-color: var(--light-bg);
            border-top: 1px solid var(--border-color);
            text-align: right;
        }

        .university-card-footer button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .university-card-footer button:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }

        /* Authentication & Info Sections */
        #auth-section, #contact-section, #help-section, #premium-page, #profile-page {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 60vh;
        }
        
        .auth-form, .info-form, .profile-content {
            background-color: var(--primary-color);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--shadow-color);
            width: 100%;
            max-width: 400px;
            text-align: center;
            margin-top: 20px;
            box-sizing: border-box;
            border: 1px solid var(--border-color);
        }

        .auth-form h2, .info-form h2, .profile-content h2 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 1.6rem;
        }

        .auth-form input, .info-form input, .info-form textarea, .profile-content input, .profile-content select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            background-color: var(--light-bg);
            color: var(--text-color);
            border-radius: 5px;
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .auth-form input:focus, .info-form input:focus, .info-form textarea:focus, .profile-content input:focus, .profile-content select:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
        }
        
        .info-form textarea {
            resize: vertical;
            min-height: 100px;
        }

        .auth-form button, .info-form button, .profile-content button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            width: 100%;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .auth-form button:hover, .info-form button:hover, .profile-content button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }
        
        .auth-form p {
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .auth-form .guest-link {
            margin-top: 10px;
        }

        .auth-form p a {
            color: var(--secondary-color);
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }

        .auth-form p a:hover {
            color: #0056b3;
        }

        /* Profile Page Styles */
        #profile-page .profile-content {
            max-width: 800px;
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        #profile-page .profile-summary {
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
        }
        
        #profile-page .profile-summary h2 {
            margin-bottom: 5px;
            color: var(--secondary-color);
        }
        
        #profile-page .profile-summary p {
            margin: 0;
            color: #555;
        }
        
        #profile-page .profile-info, #profile-page .profile-actions {
            background-color: var(--light-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }
        
        #profile-page .profile-info h3, #profile-page .profile-actions h3 {
            color: var(--secondary-color);
            font-size: 1.1rem;
            margin-top: 0;
        }
        
        #profile-page .profile-info p {
            margin: 5px 0;
            color: #555;
        }
        
        #profile-page .profile-info .label {
            font-weight: 600;
            color: #333;
        }
        
        #profile-page .profile-actions button {
            margin-top: 10px;
        }
        
        #myApplicationsList {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }
        
        .application-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: var(--primary-color);
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px var(--shadow-color);
            border: 1px solid var(--border-color);
        }
        
        .application-item span {
            font-weight: 500;
            color: #555;
        }
        
        .application-item .status {
            font-weight: bold;
            color: var(--success-color);
        }
        
        #deleteAccountBtn {
            background-color: var(--error-color);
            color: white;
            margin-top: 20px;
        }
        
        #deleteAccountBtn:hover {
            background-color: #c82333;
        }
        
        /* Modals */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            animation: fadeInOverlay 0.3s ease-out;
        }

        .modal-content {
            background-color: var(--primary-color);
            margin: auto;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 8px 25px var(--shadow-color);
            width: 90%;
            max-width: 700px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            opacity: 0;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            border: 1px solid var(--border-color);
        }

        .modal.active {
            display: flex;
        }

        .modal.active .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-button:hover,
        .close-button:focus {
            color: #000;
            text-decoration: none;
        }
        
        .modal-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        #modalUniversityName {
            color: var(--secondary-color);
            margin-bottom: 10px;
            font-size: 2rem;
            font-weight: 700;
        }

        #modalUniversityType,
        #modalUniversityLocation,
        #modalUniversityPhone,
        #modalUniversityDescription {
            margin-bottom: 10px;
            font-size: 1rem;
            color: #555;
        }
        
        #modalUniversityDiscount {
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--success-color);
            font-size: 1.1rem;
        }
        
        #modalUniversityMapAccess {
            margin-bottom: 15px;
            font-style: italic;
            color: #777;
        }

        #modalFaculties {
            list-style: none;
            padding: 0;
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        #modalFaculties li {
            background-color: var(--light-bg);
            color: var(--text-color);
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9rem;
            border: 1px solid var(--border-color);
        }

        #universityMap {
            height: 300px;
            width: 100%;
            margin-top: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .premium-feature {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 15px;
            margin-right: 10px;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .premium-feature:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        .premium-feature.disabled {
            background-color: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        /* Premium Page */
        .premium-page-content {
            background-color: var(--primary-color);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--shadow-color);
            max-width: 900px;
            width: 100%;
            margin-top: 20px;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        
        .premium-page-content h2 {
            font-size: 2.2rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }

        .premium-page-content .payment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .premium-page-content .payment-plan {
            background-color: var(--light-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 25px;
            text-align: center;
            flex: 1;
            min-width: 180px;
            box-shadow: 0 2px 8px var(--shadow-color);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .premium-page-content .payment-plan:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--shadow-color);
        }
        
        .premium-page-content .payment-plan h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }

        .premium-page-content .payment-plan p {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 20px;
        }
        
        .premium-page-content .payment-plan ul {
            list-style: none;
            padding: 0;
            text-align: left;
            margin-bottom: 20px;
            flex-grow: 1;
        }

        .premium-page-content .payment-plan ul li {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: #555;
        }
        
        .premium-page-content .payment-plan ul li::before {
            content: '✓';
            color: var(--success-color);
            font-weight: bold;
            margin-right: 8px;
            font-size: 1.1em;
        }

        .premium-page-content .payment-plan button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        
        .premium-page-content .payment-plan button.current-plan {
            background-color: var(--success-color);
            cursor: default;
        }
        
        .premium-page-content .payment-plan button:not(.current-plan):hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }
        
        .premium-page-content .payment-plan button[disabled] {
            cursor: not-allowed;
            background-color: #ccc;
            box-shadow: none;
        }

        .premium-badge {
            background-color: var(--accent-color);
            color: var(--text-color);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        
        #applicationForm, #changePasswordForm {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        #applicationForm input, #changePasswordForm input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            background-color: var(--light-bg);
            color: var(--text-color);
            border-radius: 5px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        #applicationForm .submit-btn, #changePasswordForm .submit-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        
        #applicationForm .submit-btn:hover, #changePasswordForm .submit-btn:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }
        
        .payment-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .payment-form input[type="text"],
        .payment-form input[type="tel"],
        .payment-form input[type="password"] {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            background-color: var(--light-bg);
            color: var(--text-color);
            border-radius: 5px;
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .payment-form input[type="text"]:focus,
        .payment-form input[type="tel"]:focus,
        .payment-form input[type="password"]:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
        }
        
        .payment-form .payment-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        
        .payment-form .payment-option input[type="radio"] {
            width: auto;
            margin-right: 5px;
            transform: scale(1.1);
            cursor: pointer;
        }
        
        .payment-form .payment-option label {
            font-size: 1rem;
            font-weight: bold;
            color: var(--secondary-color);
        }

        .payment-form button {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        
        .payment-form button:hover {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        /* Info Pages */
        .help-section-content, .contact-section-content {
            background-color: var(--primary-color);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--shadow-color);
            max-width: 800px;
            width: 100%;
            margin-top: 20px;
            text-align: left;
            border: 1px solid var(--border-color);
        }

        .help-section-content h2, .contact-section-content h2, #premium-page h2 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 2rem;
            text-align: center;
        }

        .help-section-content h3 {
            color: var(--secondary-color);
            margin-top: 25px;
            margin-bottom: 10px;
        }
        
        .help-section-content p {
            margin-bottom: 15px;
            color: #555;
        }

        footer {
            background-color: var(--primary-color);
            color: #555;
            text-align: center;
            padding: 1rem 0;
            margin-top: auto;
            border-top: 1px solid var(--border-color);
        }

        footer .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            padding: 0 20px;
        }

        footer nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }
        
        footer nav ul li {
            margin: 0 10px;
        }

        footer nav ul li a {
            color: #555;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        footer nav ul li a:hover {
            color: var(--secondary-color);
        }

        .hidden {
            display: none !important;
        }

        .no-results {
            text-align: center;
            font-size: 1.1rem;
            color: #999;
            padding: 50px 0;
        }
        
        #authRequiredModal .modal-content, #confirmDeleteModal .modal-content {
            text-align: center;
            padding: 30px;
        }
        
        #authRequiredModal .modal-content button, #confirmDeleteModal .modal-content button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0 10px;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        
        #authRequiredModal .modal-content button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        
        #confirmDeleteModal .modal-content #cancelDeleteBtn {
            background-color: #6c757d;
        }

        #confirmDeleteModal .modal-content #cancelDeleteBtn:hover {
            background-color: #5a6268;
        }
        
        #confirmDeleteModal .modal-content #confirmDeleteBtn {
            background-color: var(--error-color);
        }
        
        #confirmDeleteModal .modal-content #confirmDeleteBtn:hover {
            background-color: #c82333;
        }
        
        .faq-item {
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
        }
        
        .faq-question {
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--secondary-color);
            font-size: 1.05rem;
            transition: color 0.3s ease;
        }
        
        .faq-question:hover {
            color: #0056b3;
        }

        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding-top 0.3s ease;
            padding-top: 0;
            font-size: 0.9rem;
            color: #555;
        }
        
        .faq-answer.open {
            max-height: 200px;
            padding-top: 15px;
        }
        
        .faq-question .arrow {
            transition: transform 0.3s ease;
        }
        
        .faq-question.active .arrow {
            transform: rotate(180deg);
        }

        /* Notifications */
        #notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification {
            background-color: var(--primary-color);
            color: var(--text-color);
            padding: 12px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 12px var(--shadow-color);
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transform: translateX(100%);
            animation: slideIn 0.5s forwards, fadeOut 0.5s 4.5s forwards;
            font-weight: 500;
            border: 1px solid var(--border-color);
        }
        
        .notification.success {
            border-left: 4px solid var(--success-color);
        }
        
        .notification.error {
            border-left: 4px solid var(--error-color);
        }

        .notification .icon {
            font-size: 1.2rem;
        }

        .notification.success .icon {
            color: var(--success-color);
        }
        
        .notification.error .icon {
            color: var(--error-color);
        }
        
        #enrollmentForm, #changePasswordForm {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        #enrollmentForm input, #changePasswordForm input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            background-color: var(--light-bg);
            color: var(--text-color);
            border-radius: 5px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        #enrollmentForm .submit-btn, #changePasswordForm .submit-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        
        #enrollmentForm .submit-btn:hover, #changePasswordForm .submit-btn:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        /* Keyframe Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInOverlay {
            from { background-color: rgba(0,0,0,0); }
            to { background-color: rgba(0,0,0,0.5); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100%); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            header .container {
                flex-direction: column;
                text-align: center;
            }

            header nav ul {
                margin-top: 15px;
                justify-content: center;
            }

            header nav ul li {
                margin: 0 10px;
            }
            
            #hero-section h2 {
                font-size: 2.2rem;
            }

            #hero-section p {
                font-size: 1rem;
            }

            .search-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .search-bar input,
            .search-bar select,
            .search-bar button {
                width: 100%;
                min-width: unset;
            }

            .university-grid {
                grid-template-columns: 1fr;
            }
            
            .premium-page-content .payment-options {
                grid-template-columns: 1fr;
            }

            .auth-form, .info-form {
                padding: 20px;
            }
            
            .profile-content {
                padding: 20px;
            }
            
            .modal-content {
                padding: 20px;
            }

            .close-button {
                top: 10px;
                right: 15px;
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>EduPath</h1>
            <nav>
                <ul>
                    <li><a href="#" id="homeLink">Home</a></li>
                    <li><a href="#" id="premiumLink">Premium</a></li>
                    <li id="profileLinkItem" class="hidden"><a href="#" id="profileLink">My Profile</a></li>
                    <li><a href="#" id="authLink">Login</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div id="backButtonContainer">
            <a href="#" id="backButton" class="hidden"><span>&larr;</span> Back</a>
        </div>
        <div class="container">
            <section id="hero-section">
                <h2>Find Your Perfect University</h2>
                <p>EduPath helps you find the best universities in Egypt based on your score, interests, and preferences. Start your journey today.</p>
                <button id="startSearchBtn">Start Finding</button>
            </section>
            
            <section id="auth-section" class="hidden">
                <div class="auth-form" id="loginForm">
                    <h2>Login to Your Account</h2>
                    <input type="text" id="loginUsername" placeholder="Username" value="test">
                    <input type="password" id="loginPassword" placeholder="Password" value="123">
                    <button id="loginBtn">Login</button>
                    <p>Don't have an account? <a href="#" id="showRegister">Register</a></p>
                    <p class="guest-link"><a href="#" id="continueAsGuest">Continue as Guest</a></p>
                </div>
                <div class="auth-form hidden" id="registerForm">
                    <h2>Create a New Account</h2>
                    <input type="text" id="registerUsername" placeholder="Username">
                    <input type="email" id="registerEmail" placeholder="Email">
                    <input type="password" id="registerPassword" placeholder="Password">
                    <input type="password" id="registerConfirmPassword" placeholder="Confirm Password">
                    <button id="registerBtn">Register</button>
                    <p>Already have an account? <a href="#" id="showLogin">Login</a></p>
                </div>
            </section>
            
            <section id="finder-section" class="hidden">
                <div class="search-bar">
                    <input type="number" id="userScore" placeholder="Your Score (e.g., 90)">
                    <select id="facultyType">
                        <option value="">All Faculties</option>
                        <option value="Medicine">Medicine</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Business">Business & Economics</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Pharmacy">Pharmacy</option>
                        <option value="Arts & Humanities">Arts & Humanities</option>
                        <option value="Law">Law</option>
                        <option value="Science">Science</option>
                        <option value="Dentistry">Dentistry</option>
                    </select>
                    <select id="universityType">
                        <option value="">All University Types</option>
                        <option value="Public">Public</option>
                        <option value="Private">Private</option>
                        <option value="International">International</option>
                    </select>
                    <input type="text" id="universityName" placeholder="Search by University Name">
                    <button id="searchBtn">Search</button>
                </div>
                
                <section id="recommendation-section" class="hidden">
                    <h2>Recommended for You</h2>
                    <p>These universities match your score and interests.</p>
                    <div id="recommendation-list" class="university-grid"></div>
                </section>

                <div class="premium-badge hidden" id="premiumUserBadge">Premium User</div>
                <div id="university-list" class="university-grid"></div>
            </section>
            
            <section id="premium-page" class="hidden">
                <div class="premium-page-content">
                    <h2 id="premiumPageHeader">Choose Your Premium Plan</h2>
                    <p>Upgrade to a premium plan to unlock exclusive features and discounts.</p>
                    <div class="payment-options">
                        <div class="payment-plan">
                            <h3>Standard Plan</h3>
                            <p>EGP 100 / month</p>
                            <ul>
                                <li>4% discount on selected private universities</li>
                                <li>Access to university locations on the map</li>
                                <li>Priority support</li>
                            </ul>
                            <button class="buy-plan-btn" data-plan="standard">Get Started</button>
                        </div>
                        <div class="payment-plan">
                            <h3>Advanced Plan</h3>
                            <p>EGP 150 / month</p>
                            <ul>
                                <li>8% discount on selected private universities</li>
                                <li>All benefits of the Standard Plan</li>
                                <li>Exclusive partner offers</li>
                            </ul>
                            <button class="buy-plan-btn" data-plan="advanced">Get Started</button>
                        </div>
                         <div class="payment-plan">
                            <h3>Pro Plan</h3>
                            <p>EGP 200 / month</p>
                            <ul>
                                <li>15% discount on selected private universities</li>
                                <li>All benefits of the Advanced Plan</li>
                                <li>Personalized guidance from a counselor</li>
                            </ul>
                            <button class="buy-plan-btn" data-plan="pro">Get Started</button>
                        </div>
                    </div>
                    <p id="premiumStatus" style="text-align: center; margin-top: 20px;"></p>
                </div>
            </section>
            
            <section id="profile-page" class="hidden">
                <div class="profile-content">
                    <div class="profile-summary">
                        <h2>Hello, <span id="profileUsername"></span>!</h2>
                        <p id="profileEmail"></p>
                    </div>
                    
                    <div class="profile-info">
                        <h3>Your Subscription</h3>
                        <p><span class="label">Plan:</span> <span id="profilePlan">Free User</span></p>
                        <button id="managePremiumBtn" class="premium-feature">View Premium Plans</button>
                    </div>

                    <div class="profile-info">
                        <h3>My Applications</h3>
                        <p id="noApplicationsText" style="text-align: center; color: #777;">You have not sent any applications yet.</p>
                        <ul id="myApplicationsList"></ul>
                    </div>

                    <div class="profile-actions">
                        <h3>Account Settings</h3>
                        <div id="changePasswordForm">
                            <input type="password" id="currentPassword" placeholder="Current Password">
                            <input type="password" id="newPassword" placeholder="New Password">
                            <input type="password" id="confirmNewPassword" placeholder="Confirm New Password">
                            <button id="changePasswordBtn" class="submit-btn">Change Password</button>
                        </div>
                        <button id="deleteAccountBtn">Delete Account</button>
                    </div>
                </div>
            </section>
            
            <section id="contact-section" class="hidden">
                <div class="contact-section-content">
                    <h2>Contact Us</h2>
                    <p>If you have any questions, please fill out the form below. We will get back to you as soon as possible.</p>
                    <form class="info-form" id="contactForm">
                        <input type="text" id="contactName" placeholder="Your Name" required>
                        <input type="email" id="contactEmail" placeholder="Your Email" required>
                        <textarea id="contactMessage" placeholder="Your Message" required></textarea>
                        <button type="submit">Send Message</button>
                    </form>
                </div>
            </section>
            
            <section id="help-section" class="hidden">
                <div class="help-section-content">
                    <h2>Help & FAQ</h2>
                    <p>Find answers to common questions about using our service.</p>
                    <div class="faq-section">
                        <div class="faq-item">
                            <div class="faq-question">
                                <span>How do I search for universities?</span>
                                <span class="arrow">&#9660;</span>
                            </div>
                            <div class="faq-answer">
                                <p>On the home page, you can enter your score and select your desired faculty to see a list of universities that match your criteria. You can also filter by university type or search by name.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question">
                                <span>What is the Premium Plan?</span>
                                <span class="arrow">&#9660;</span>
                            </div>
                            <div class="faq-answer">
                                <p>The Premium Plan is a subscription service that gives you access to exclusive features like university discounts and map locations. It helps you make a better-informed decision about your future.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question">
                                <span>Can I apply to universities as a guest?</span>
                                <span class="arrow">&#9660;</span>
                            </div>
                            <div class="faq-answer">
                                <p>No, you need to create an account and log in to submit an application. This is to ensure we can keep track of your applications and provide you with updates.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question">
                                <span>What information do I need for an application?</span>
                                <span class="arrow">&#9660;</span>
                            </div>
                            <div class="faq-answer">
                                <p>You will be asked to provide your full name, national ID, date of birth, phone number, and address. This information is sent directly to the university to start your application process.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>
    
    <div id="notification-container"></div>

    <div id="universityModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <img id="modalUniversityImage" class="modal-image" src="" alt="University Image">
            <h2 id="modalUniversityName"></h2>
            <p id="modalUniversityType"></p>
            <p id="modalUniversityLocation"></p>
            <p id="modalUniversityPhone"></p>
            <p id="modalUniversityDiscount"></p>
            <p id="modalUniversityMapAccess"></p>
            <p id="modalUniversityDescription"></p>
            <hr>
            <h3>Faculties & Minimum Scores</h3>
            <ul id="modalFaculties"></ul>
            <div id="universityMap"></div>
            <button id="applyNowBtn" class="premium-feature">Apply Now</button>
        </div>
    </div>
    
    <div id="applicationModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Apply to <span id="applicationUniName"></span></h2>
            <form id="enrollmentForm">
                <input type="text" id="applicantName" placeholder="Full Name" required>
                <input type="text" id="applicantNationalId" placeholder="National ID" required>
                <input type="date" id="applicantDOB" placeholder="Date of Birth (YYYY-MM-DD)" required>
                <input type="tel" id="applicantPhone" placeholder="Phone Number" required>
                <input type="text" id="applicantAddress" placeholder="Address" required>
                <input type="number" id="applicantScore" placeholder="Your Score (%)" required min="0" max="100">
                <button type="submit" class="submit-btn">Submit Application</button>
            </form>
        </div>
    </div>
    
    <div id="purchaseModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Purchase <span id="purchasePlanName"></span></h2>
            <p>Choose a payment method to complete your purchase.</p>
            <form id="purchaseForm" class="payment-form">
                <div class="payment-option">
                    <input type="radio" id="payByWallet" name="paymentMethod" value="wallet" checked>
                    <label for="payByWallet">Mobile Wallet</label>
                </div>
                <div class="payment-option">
                    <input type="radio" id="payByCard" name="paymentMethod" value="card">
                    <label for="payByCard">Credit/Debit Card</label>
                </div>

                <div id="walletDetails">
                    <input type="tel" id="walletNumber" placeholder="Mobile Wallet Number" required>
                </div>
                
                <div id="cardDetails" class="hidden">
                    <input type="text" id="cardNumber" placeholder="Card Number" required>
                    <input type="text" id="cardHolder" placeholder="Card Holder Name" required>
                    <input type="text" id="cardExpiry" placeholder="MM/YY" required>
                    <input type="text" id="cardCVC" placeholder="CVC" required>
                    <input type="password" id="cardPassword" placeholder="Card Password" required>
                </div>
                
                <button type="submit">Complete Payment</button>
            </form>
        </div>
    </div>

    <div id="authRequiredModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Login Required</h2>
            <p>You must be logged in to access this feature.</p>
            <button id="authLoginBtn">Login</button>
            <button id="authRegisterBtn">Register</button>
        </div>
    </div>
    
    <div id="confirmDeleteModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Are you sure?</h2>
            <p>This action will permanently delete your account and all associated data. This cannot be undone.</p>
            <button id="confirmDeleteBtn">Delete Account</button>
            <button id="cancelDeleteBtn">Cancel</button>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 EduPath. All rights reserved.</p>
            <nav>
                <ul>
                    <li><a href="#" id="footerHelpLink">Help</a></li>
                    <li><a href="#" id="footerContactLink">Contact</a></li>
                </ul>
            </nav>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const universities = [
                { id: 1, name: "Cairo University", type: "Public", location: "Giza, Cairo", address: "El-Gamaa St, Giza", phone: "+20235676105", image: "https://via.placeholder.com/600x400/007bff/ffffff?text=Cairo+University", description: "One of Egypt's oldest and most prestigious universities.", faculties: [{ name: "Medicine", minScore: 92 }, { name: "Engineering", minScore: 88 }, { name: "Pharmacy", minScore: 89 }, { name: "Law", minScore: 85 }, { name: "Arts & Humanities", minScore: 75 }], discount: 0, coords: [30.0275, 31.2098], },
                { id: 2, name: "American University in Cairo (AUC)", type: "International", location: "New Cairo, Cairo", address: "AUC Avenue, New Cairo", phone: "+20226151000", image: "https://via.placeholder.com/600x400/17a2b8/ffffff?text=AUC", description: "An independent, English-language, liberal arts university.", faculties: [{ name: "Business", minScore: 90 }, { name: "Computer Science", minScore: 88 }, { name: "Engineering", minScore: 88 }, { name: "Arts & Humanities", minScore: 80 }, { name: "Law", minScore: 85 }], discount: 0, coords: [29.9868, 31.4552], },
                { id: 3, name: "Ain Shams University", type: "Public", location: "Cairo", address: "El-Khalyfa El-Mamoun Street, Abbasya", phone: "+20226831231", image: "https://via.placeholder.com/600x400/6f42c1/ffffff?text=Ain+Shams+University", description: "A prominent public university known for its medical and engineering schools.", faculties: [{ name: "Medicine", minScore: 91 }, { name: "Engineering", minScore: 87 }, { name: "Computer Science", minScore: 86 }, { name: "Business", minScore: 84 }], discount: 0, coords: [30.0763, 31.2858], },
                { id: 4, name: "German University in Cairo (GUC)", type: "International", location: "New Cairo, Cairo", address: "Main Entrance of Al-Tagamoa Al-Khames", phone: "+20227590769", image: "https://via.placeholder.com/600x400/28a745/ffffff?text=GUC", description: "An Egyptian private university established in cooperation with German state universities.", faculties: [{ name: "Engineering", minScore: 88 }, { name: "Computer Science", minScore: 87 }, { name: "Business", minScore: 85 }, { name: "Arts & Humanities", minScore: 78 }], discount: 0, coords: [29.9701, 31.4447], },
                { id: 5, name: "Future University in Egypt (FUE)", type: "Private", location: "New Cairo, Cairo", address: "90th St., Fifth Settlement", phone: "+20226186100", image: "https://via.placeholder.com/600x400/fd7e14/ffffff?text=FUE", description: "A leading private university offering modern facilities and a diverse range of programs.", faculties: [{ name: "Pharmacy", minScore: 85 }, { name: "Engineering", minScore: 82 }, { name: "Business", minScore: 80 }, { name: "Computer Science", minScore: 83 }], discount: 0, coords: [30.0152, 31.4485], },
                { id: 6, name: "Helwan University", type: "Public", location: "Helwan, Cairo", address: "Helwan Sharkeya, Helwan", phone: "+20228162061", image: "https://via.placeholder.com/600x400/6c757d/ffffff?text=Helwan+University", description: "Known for its arts and applied arts faculties, it's a major public university.", faculties: [{ name: "Arts & Humanities", minScore: 78 }, { name: "Engineering", minScore: 84 }, { name: "Business", minScore: 79 }, { name: "Science", minScore: 82 }], discount: 0, coords: [29.8519, 31.3320], },
                { id: 7, name: "British University in Egypt (BUE)", type: "International", location: "El Shorouk City, Cairo", address: "El Sherouk City, Suez Desert Road", phone: "+2019283", image: "https://via.placeholder.com/600x400/dc3545/ffffff?text=BUE", description: "An Egyptian private university offering a British-style education.", faculties: [{ name: "Pharmacy", minScore: 87 }, { name: "Engineering", minScore: 85 }, { name: "Business", minScore: 83 }, { name: "Computer Science", minScore: 85 }, { name: "Law", minScore: 80 }], discount: 0, coords: [30.1340, 31.5975], },
                { id: 8, name: "Mansoura University", type: "Public", location: "Mansoura", address: "Elgomhouria St., Mansoura City", phone: "+20502383781", image: "https://via.placeholder.com/600x400/ffc107/ffffff?text=Mansoura+University", description: "A large Egyptian public university known for its medical and science programs.", faculties: [{ name: "Medicine", minScore: 93 }, { name: "Engineering", minScore: 89 }, { name: "Pharmacy", minScore: 90 }, { name: "Law", minScore: 86 }], discount: 0, coords: [31.0450, 31.3789], },
                { id: 9, name: "Alexandria University", type: "Public", location: "Alexandria", address: "22 El-Guish Road, El-Shatby", phone: "+2035921675", image: "https://via.placeholder.com/600x400/17a2b8/ffffff?text=Alexandria+University", description: "One of the largest universities in Egypt, offering a wide range of faculties.", faculties: [{ name: "Medicine", minScore: 91 }, { name: "Engineering", minScore: 87 }, { name: "Computer Science", minScore: 85 }, { name: "Law", minScore: 84 }, { name: "Business", minScore: 83 }, { name: "Pharmacy", minScore: 88 }], discount: 0, coords: [31.2001, 29.9187], },
                { id: 10, name: "Zewail City of Science and Technology", type: "Private", location: "Sheikh Zayed, Giza", address: "Ahmed Zewail Road, October Gardens", phone: "+201033077738", image: "https://via.placeholder.com/600x400/343a40/ffffff?text=Zewail+City", description: "A non-profit institution of learning, research, and innovation focused on science and technology.", faculties: [{ name: "Engineering", minScore: 90 }, { name: "Science", minScore: 91 }, { name: "Computer Science", minScore: 89 }], discount: 0, coords: [29.9867, 30.9859], },
            ];

            const universityList = document.getElementById('university-list');
            const recommendationList = document.getElementById('recommendation-list');
            const userScoreInput = document.getElementById('userScore');
            const facultyTypeSelect = document.getElementById('facultyType');
            const universityTypeSelect = document.getElementById('universityType');
            const universityNameInput = document.getElementById('universityName');
            const searchBtn = document.getElementById('searchBtn');

            const homeLink = document.getElementById('homeLink');
            const premiumLink = document.getElementById('premiumLink');
            const authLink = document.getElementById('authLink');
            const profileLinkItem = document.getElementById('profileLinkItem');
            const profileLink = document.getElementById('profileLink');
            const footerHelpLink = document.getElementById('footerHelpLink');
            const footerContactLink = document.getElementById('footerContactLink');
            const backButton = document.getElementById('backButton');

            const heroSection = document.getElementById('hero-section');
            const finderSection = document.getElementById('finder-section');
            const authSection = document.getElementById('auth-section');
            const contactSection = document.getElementById('contact-section');
            const helpSection = document.getElementById('help-section');
            const premiumPage = document.getElementById('premium-page');
            const profilePage = document.getElementById('profile-page');
            const recommendationSection = document.getElementById('recommendation-section');
            
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const showRegisterLink = document.getElementById('showRegister');
            const showLoginLink = document.getElementById('showLogin');
            const continueAsGuestLink = document.getElementById('continueAsGuest');
            const startSearchBtn = document.getElementById('startSearchBtn');

            const universityModal = document.getElementById('universityModal');
            const applicationModal = document.getElementById('applicationModal');
            const purchaseModal = document.getElementById('purchaseModal');
            const authRequiredModal = document.getElementById('authRequiredModal');
            const confirmDeleteModal = document.getElementById('confirmDeleteModal');
            
            const premiumUserBadge = document.getElementById('premiumUserBadge');
            const closeButtons = document.querySelectorAll('.close-button');
            const applyNowBtn = document.getElementById('applyNowBtn');
            const applicationForm = document.getElementById('enrollmentForm');
            const purchaseForm = document.getElementById('purchaseForm');
            const contactForm = document.getElementById('contactForm');
            const authLoginBtn = document.getElementById('authLoginBtn');
            const authRegisterBtn = document.getElementById('authRegisterBtn');
            const faqItems = document.querySelectorAll('.faq-item');
            
            const premiumPageHeader = document.getElementById('premiumPageHeader');
            const premiumStatusText = document.getElementById('premiumStatus');
            const buyPlanButtons = document.querySelectorAll('.buy-plan-btn');

            const walletDetails = document.getElementById('walletDetails');
            const cardDetails = document.getElementById('cardDetails');
            const paymentRadios = document.querySelectorAll('input[name="paymentMethod"]');
            
            const profileUsername = document.getElementById('profileUsername');
            const profileEmail = document.getElementById('profileEmail');
            const profilePlan = document.getElementById('profilePlan');
            const myApplicationsList = document.getElementById('myApplicationsList');
            const noApplicationsText = document.getElementById('noApplicationsText');
            const managePremiumBtn = document.getElementById('managePremiumBtn');
            const deleteAccountBtn = document.getElementById('deleteAccountBtn');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            const changePasswordBtn = document.getElementById('changePasswordBtn');
            
            let isAuthenticated = false;
            let premiumPlan = null;
            let currentUser = null;
            let applications = [];
            let currentMap = null;
            let currentUniversity = null;

            const saveState = () => {
                localStorage.setItem('isAuthenticated', isAuthenticated);
                localStorage.setItem('premiumPlan', premiumPlan);
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                localStorage.setItem('applications', JSON.stringify(applications));
            };

            const loadState = () => {
                isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';
                premiumPlan = localStorage.getItem('premiumPlan');
                const storedUser = localStorage.getItem('currentUser');
                if (storedUser && storedUser !== 'null') {
                    currentUser = JSON.parse(storedUser);
                } else {
                    currentUser = null;
                }
                const storedApps = localStorage.getItem('applications');
                if (storedApps) {
                    applications = JSON.parse(storedApps);
                }
                updateUI();
            };
            
            const showNotification = (message, type) => {
                const container = document.getElementById('notification-container');
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                const icon = type === 'success' ? '✓' : '✗';
                notification.innerHTML = `<span class="icon">${icon}</span><span>${message}</span>`;
                container.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 5000);
            };

            const getDiscount = (uniType) => {
                if (uniType === "Public") return 0;
                if (premiumPlan === 'pro') return 15;
                if (premiumPlan === 'advanced') return 8;
                if (premiumPlan === 'standard') return 4;
                return 0;
            };
            
            const isGuest = () => !isAuthenticated && !currentUser;

            const updateUI = () => {
                if (isGuest()) {
                    authLink.textContent = 'Login';
                    profileLinkItem.classList.add('hidden');
                } else {
                    authLink.textContent = 'Logout';
                    profileLinkItem.classList.remove('hidden');
                }
                
                if (premiumPlan) {
                    premiumUserBadge.classList.remove('hidden');
                    const planName = premiumPlan.charAt(0).toUpperCase() + premiumPlan.slice(1);
                    premiumUserBadge.textContent = `${planName} Plan User`;
                    premiumLink.textContent = 'My Premium Plan';
                } else {
                    premiumUserBadge.classList.add('hidden');
                    premiumLink.textContent = 'Premium';
                }
            };
            
            const showSection = (sectionToShow) => {
                const allSections = [heroSection, finderSection, authSection, contactSection, helpSection, premiumPage, profilePage];
                allSections.forEach(section => {
                    if (section === sectionToShow) {
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                });
                
                if (sectionToShow === finderSection || sectionToShow === authSection || sectionToShow === heroSection) {
                    backButton.classList.add('hidden');
                } else {
                    backButton.classList.remove('hidden');
                }
            };

            const showGuestView = () => {
                isAuthenticated = false;
                currentUser = null;
                applications = [];
                saveState();
                showFinder();
                updateUI();
            };

            const showFinder = () => {
                showSection(finderSection);
                closeModals();
                renderUniversities(universities, universityList);
                recommendationSection.classList.add('hidden');
            };

            const renderUniversities = (unis, container) => {
                container.innerHTML = '';
                if (unis.length === 0) {
                    container.innerHTML = `<div class="no-results">No universities found. Try adjusting your search criteria.</div>`;
                    return;
                }

                unis.forEach(uni => {
                    const card = document.createElement('div');
                    card.className = 'university-card';
                    card.dataset.id = uni.id;

                    const facultiesHtml = uni.faculties.map(faculty => {
                        const scoreText = faculty.minScore ? ` (${faculty.minScore}%)` : '';
                        return `<li>${faculty.name}${scoreText}</li>`;
                    }).join('');
                    
                    const discount = getDiscount(uni.type);
                    const discountHtml = discount > 0 ? `<p class="discount">${discount}% Premium Discount!</p>` : '';
                    
                    const minScore = uni.faculties.length > 0 ? Math.min(...uni.faculties.map(f => f.minScore)) : 'N/A';
                    const minScoreHtml = minScore !== 'N/A' ? `<p class="min-score"><strong>Min. Score:</strong> ${minScore}</p>` : '';

                    card.innerHTML = `
                        <img src="${uni.image}" alt="${uni.name}" class="university-card-image">
                        <div class="university-card-header">${uni.name}</div>
                        <div class="university-card-body">
                            <p><strong>Type:</strong> ${uni.type}</p>
                            <p><strong>Location:</strong> ${uni.location}</p>
                            ${discountHtml}
                            ${minScoreHtml}
                            <p><strong>Faculties:</strong></p>
                            <ul class="faculty-list">${facultiesHtml}</ul>
                        </div>
                        <div class="university-card-footer">
                            <button class="view-details-btn">View Details</button>
                        </div>
                    `;
                    container.appendChild(card);
                });
            };

            const openUniversityModal = (uni) => {
                currentUniversity = uni;
                document.getElementById('modalUniversityImage').src = uni.image;
                document.getElementById('modalUniversityName').textContent = uni.name;
                document.getElementById('modalUniversityType').innerHTML = `<strong>University Type:</strong> ${uni.type}`;
                document.getElementById('modalUniversityLocation').innerHTML = `<strong>Address:</strong> ${uni.address}`;
                document.getElementById('modalUniversityPhone').innerHTML = `<strong>Phone:</strong> ${uni.phone}`;
                document.getElementById('modalUniversityDescription').textContent = uni.description;
                
                const discount = getDiscount(uni.type);
                const discountText = document.getElementById('modalUniversityDiscount');
                if (discount > 0) {
                    discountText.textContent = `A ${discount}% discount is available for you here!`;
                    discountText.classList.remove('hidden');
                } else {
                    discountText.classList.add('hidden');
                }
                
                const modalFacultiesList = document.getElementById('modalFaculties');
                modalFacultiesList.innerHTML = uni.faculties.map(faculty => `<li>${faculty.name} (${faculty.minScore}%)</li>`).join('');

                const mapAccessText = document.getElementById('modalUniversityMapAccess');
                const mapElement = document.getElementById('universityMap');
                
                if (uni.coords && premiumPlan) {
                    mapElement.style.display = 'block';
                    mapAccessText.style.display = 'none';
                    if (currentMap) {
                        currentMap.remove();
                    }
                    currentMap = L.map('universityMap').setView(uni.coords, 13);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    }).addTo(currentMap);
                    L.marker(uni.coords).addTo(currentMap)
                        .bindPopup(`${uni.name}`).openPopup();
                } else {
                    mapElement.style.display = 'none';
                    if (uni.type !== 'Public' && uni.coords) {
                        mapAccessText.textContent = 'Unlock a Premium Plan to see this location on the map!';
                        mapAccessText.style.display = 'block';
                    } else {
                         mapAccessText.style.display = 'none';
                    }
                }
                
                const applyNowBtn = document.getElementById('applyNowBtn');
                if (uni.type === "Private" || uni.type === "International") {
                    applyNowBtn.style.display = 'block';
                } else {
                    applyNowBtn.style.display = 'none';
                }

                universityModal.classList.add('active');
                document.body.classList.add('modal-open');
            };
            
            const openApplicationModal = () => {
                if (!isAuthenticated) {
                    closeModals();
                    openAuthRequiredModal();
                    return;
                }
                
                document.getElementById('applicationUniName').textContent = currentUniversity.name;
                closeModals();
                applicationModal.classList.add('active');
                document.body.classList.add('modal-open');
            };
            
            const openPurchaseModal = (planName) => {
                if (!isAuthenticated) {
                    closeModals();
                    openAuthRequiredModal();
                    return;
                }
                const planDisplay = planName.charAt(0).toUpperCase() + planName.slice(1) + ' Plan';

                document.getElementById('purchasePlanName').textContent = planDisplay;
                closeModals();
                purchaseModal.classList.add('active');
                document.body.classList.add('modal-open');
            };

            const openAuthRequiredModal = () => {
                authRequiredModal.classList.add('active');
                document.body.classList.add('modal-open');
            };

            const closeModals = () => {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('active');
                });
                document.body.classList.remove('modal-open');
            };
            
            const updateProfilePage = () => {
                if (!currentUser) return;
                profileUsername.textContent = currentUser.username;
                profileEmail.textContent = currentUser.email || 'N/A';
                
                let planDisplay = 'Free User';
                if (premiumPlan === 'standard') planDisplay = 'Standard Plan';
                else if (premiumPlan === 'advanced') planDisplay = 'Advanced Plan';
                else if (premiumPlan === 'pro') planDisplay = 'Pro Plan';
                profilePlan.textContent = planDisplay;

                myApplicationsList.innerHTML = '';
                if (applications.length > 0) {
                    noApplicationsText.classList.add('hidden');
                    applications.forEach(app => {
                        const listItem = document.createElement('li');
                        listItem.className = 'application-item';
                        listItem.innerHTML = `
                            <span>${app.universityName}</span>
                            <span class="status">${app.status}</span>
                        `;
                        myApplicationsList.appendChild(listItem);
                    });
                } else {
                    noApplicationsText.classList.remove('hidden');
                }
                
                managePremiumBtn.textContent = premiumPlan ? 'View Premium Plans' : 'Get a Premium Plan';
            };

            searchBtn.addEventListener('click', () => {
                const userScore = parseFloat(userScoreInput.value) || 0;
                const facultyType = facultyTypeSelect.value;
                const universityType = universityTypeSelect.value;
                const universityName = universityNameInput.value.toLowerCase();

                const filteredUniversities = universities.filter(uni => {
                    const matchesScore = uni.faculties.some(faculty => userScore >= faculty.minScore);
                    const matchesFaculty = !facultyType || uni.faculties.some(f => f.name === facultyType);
                    const matchesType = !universityType || uni.type === universityType;
                    const matchesName = uni.name.toLowerCase().includes(universityName);
                    
                    return matchesScore && matchesFaculty && matchesType && matchesName;
                });
                renderUniversities(filteredUniversities, universityList);
                
                const recommendedUnis = universities.filter(uni => uni.type === 'Private' || uni.type === 'International')
                                                  .filter(uni => uni.faculties.some(f => userScore >= f.minScore - 5));
                if (recommendedUnis.length > 0) {
                    recommendationSection.classList.remove('hidden');
                    renderUniversities(recommendedUnis.slice(0, 3), recommendationList);
                } else {
                    recommendationSection.classList.add('hidden');
                }
            });

            universityList.addEventListener('click', (e) => {
                const card = e.target.closest('.university-card');
                if (!card) return;

                const uniId = parseInt(card.dataset.id);
                const university = universities.find(u => u.id === uniId);
                
                if (e.target.classList.contains('view-details-btn')) {
                    openUniversityModal(university);
                } else {
                    openUniversityModal(university);
                }
            });
            
            backButton.addEventListener('click', (e) => {
                e.preventDefault();
                showFinder();
            });

            homeLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (isAuthenticated) {
                    showFinder();
                } else {
                    showSection(heroSection);
                }
            });
            
            premiumLink.addEventListener('click', (e) => {
                e.preventDefault();
                closeModals();
                if (!isAuthenticated) {
                    openAuthRequiredModal();
                    return;
                }
                showSection(premiumPage);
                
                if (premiumPlan) {
                    premiumPageHeader.textContent = 'Manage Your Plan';
                    const planDisplay = premiumPlan === 'standard' ? 'Standard Plan' : premiumPlan === 'advanced' ? 'Advanced Plan' : 'Pro Plan';
                    premiumStatusText.textContent = `You are currently on the ${planDisplay}.`;
                    buyPlanButtons.forEach(btn => {
                        btn.disabled = true;
                        btn.textContent = 'Get Started';
                        btn.classList.remove('current-plan');
                        if (btn.dataset.plan === premiumPlan) {
                           btn.classList.add('current-plan');
                           btn.textContent = 'Current Plan';
                        }
                    });
                } else {
                    premiumPageHeader.textContent = 'Choose Your Premium Plan';
                    premiumStatusText.textContent = '';
                    buyPlanButtons.forEach(btn => {
                        btn.disabled = false;
                        btn.textContent = 'Get Started';
                        btn.classList.remove('current-plan');
                    });
                }
            });
            
            profileLink.addEventListener('click', (e) => {
                e.preventDefault();
                closeModals();
                if (!isAuthenticated) {
                    openAuthRequiredModal();
                    return;
                }
                showSection(profilePage);
                updateProfilePage();
            });
            
            managePremiumBtn.addEventListener('click', (e) => {
                e.preventDefault();
                premiumLink.click();
            });

            footerHelpLink.addEventListener('click', (e) => {
                e.preventDefault();
                closeModals();
                showSection(helpSection);
            });

            footerContactLink.addEventListener('click', (e) => {
                e.preventDefault();
                closeModals();
                showSection(contactSection);
            });

            authLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (isAuthenticated) {
                    isAuthenticated = false;
                    premiumPlan = null;
                    currentUser = null;
                    applications = [];
                    saveState();
                    showSection(authSection);
                    showNotification('You have been logged out.', 'success');
                } else {
                    showSection(authSection);
                    loginForm.classList.remove('hidden');
                    registerForm.classList.add('hidden');
                }
                updateUI();
                renderUniversities(universities, universityList);
            });

            continueAsGuestLink.addEventListener('click', (e) => {
                e.preventDefault();
                showGuestView();
            });

            showRegisterLink.addEventListener('click', (e) => {
                e.preventDefault();
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
            });

            showLoginLink.addEventListener('click', (e) => {
                e.preventDefault();
                registerForm.classList.add('hidden');
                loginForm.classList.remove('hidden');
            });

            loginBtn.addEventListener('click', () => {
                const username = loginUsername.value;
                const password = loginPassword.value;
                if (username === 'test' && password === '123') {
                    isAuthenticated = true;
                    currentUser = { username: 'test', email: 'test@edupath.com' };
                    saveState();
                    showNotification('Login successful!', 'success');
                    showFinder();
                } else {
                    showNotification('Invalid username or password.', 'error');
                }
                updateUI();
            });

            registerBtn.addEventListener('click', () => {
                const username = registerUsername.value;
                const email = registerEmail.value;
                const password = registerPassword.value;
                const confirmPassword = registerConfirmPassword.value;

                if (!username || !email || !password || !confirmPassword) {
                    showNotification('All fields are required.', 'error');
                    return;
                }
                if (password !== confirmPassword) {
                    showNotification('Passwords do not match.', 'error');
                    return;
                }
                isAuthenticated = true;
                currentUser = { username: username, email: email };
                showNotification('Registration successful! Please log in.', 'success');
                saveState();
                showSection(authSection);
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                updateUI();
            });

            buyPlanButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const selectedPlan = e.target.dataset.plan;
                    openPurchaseModal(selectedPlan);
                });
            });

            purchaseForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const planName = document.getElementById('purchasePlanName').textContent.split(' ')[0].toLowerCase();
                const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
                
                let isValid = false;
                if (paymentMethod === 'wallet') {
                    if (document.getElementById('walletNumber').value) isValid = true;
                } else {
                    const cardInputs = ['cardNumber', 'cardHolder', 'cardExpiry', 'cardCVV', 'cardPassword'];
                    if (cardInputs.every(id => document.getElementById(id).value)) isValid = true;
                }

                if (isValid) {
                    premiumPlan = planName;
                    showNotification(`Your payment was successful! You now have the ${planName} plan.`, 'success');
                    saveState();
                    updateUI();
                    showFinder();
                    closeModals();
                    purchaseForm.reset(); 
                } else {
                    showNotification('Please provide all required payment details.', 'error');
                }
            });
            
            paymentRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    if (e.target.value === 'wallet') {
                        walletDetails.classList.remove('hidden');
                        cardDetails.classList.add('hidden');
                    } else {
                        walletDetails.classList.add('hidden');
                        cardDetails.classList.remove('hidden');
                    }
                });
            });
            
            changePasswordBtn.addEventListener('click', () => {
                const current = document.getElementById('currentPassword').value;
                const newPass = document.getElementById('newPassword').value;
                const confirmNew = document.getElementById('confirmNewPassword').value;
                
                if (current === '123' && newPass === confirmNew && newPass) {
                    showNotification('Password changed successfully!', 'success');
                    document.getElementById('changePasswordForm').reset();
                } else {
                    showNotification('Password change failed. Please check your inputs.', 'error');
                }
            });

            deleteAccountBtn.addEventListener('click', () => {
                closeModals();
                confirmDeleteModal.classList.add('active');
                document.body.classList.add('modal-open');
            });

            confirmDeleteBtn.addEventListener('click', () => {
                isAuthenticated = false;
                premiumPlan = null;
                currentUser = null;
                applications = [];
                saveState();
                closeModals();
                showSection(authSection);
                showNotification('Your account has been deleted.', 'success');
                updateUI();
            });

            cancelDeleteBtn.addEventListener('click', closeModals);

            applyNowBtn.addEventListener('click', openApplicationModal);
            startSearchBtn.addEventListener('click', showFinder);
            
            applicationForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const uniName = currentUniversity.name;
                
                applications.push({
                    universityName: uniName,
                    date: new Date().toLocaleDateString(),
                    status: 'Pending'
                });
                
                saveState();
                
                showNotification(`Application to ${uniName} submitted successfully!`, 'success');
                closeModals();
                applicationForm.reset();
            });
            
            contactForm.addEventListener('submit', (e) => {
                e.preventDefault();
                showNotification('Your message has been sent successfully.', 'success');
                contactForm.reset();
            });

            authLoginBtn.addEventListener('click', () => {
                closeModals();
                authLink.click();
            });

            authRegisterBtn.addEventListener('click', () => {
                closeModals();
                authLink.click();
                showRegisterLink.click();
            });

            closeButtons.forEach(btn => {
                btn.addEventListener('click', closeModals);
            });

            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    closeModals();
                }
            });
            
            faqItems.forEach(item => {
                const question = item.querySelector('.faq-question');
                const answer = item.querySelector('.faq-answer');
                
                question.addEventListener('click', () => {
                    const isOpen = answer.classList.contains('open');
                    
                    document.querySelectorAll('.faq-answer.open').forEach(openAnswer => {
                        if (openAnswer !== answer) {
                            openAnswer.classList.remove('open');
                            openAnswer.previousElementSibling.classList.remove('active');
                        }
                    });
                    
                    answer.classList.toggle('open');
                    question.classList.toggle('active');
                });
            });

            loadState();
            if (isAuthenticated) {
                showFinder();
            } else {
                showSection(heroSection);
            }
            renderUniversities(universities, universityList);
        });
    </script>
</body>
</html>